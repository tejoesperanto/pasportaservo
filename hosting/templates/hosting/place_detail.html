{% extends 'hosting/base.html' %}
{% load i18n static %}

{% block page %}
    <div class="row place-detail">
        <div class="col-xs-12 col-md-6 owner">
            <div class="row">
                <div class="col-xs-3">
                    <a href="{{ place.owner.get_absolute_url }}">
                        <img src="{{ place.owner.avatar_url }}" />
                    </a>
                </div>
                <div class="col-xs-9">
                    <div class="row">
                        <p class="col-xs-8 name">
                            <a href="{{ place.owner.get_absolute_url }}">
                                {% if user in place.authorized_users.all %}
                                    {{ place.owner.full_name }}
                                {% else %}
                                    {{ place.owner.anonymous_name }}
                                {% endif %}
                            </a>
                        </p>
                        <p class="col-xs-4 status">
                            {% if place.available %}
                                <span class="visible-xs-inline-block glyphicon glyphicon-stack" title="{% trans "available" %}">
                                    <span class="place-marker glyphicon-home glyphicon-stack-2x"></span>
                                    <span class="place-availability glyphicon-ok glyphicon-stack-1x"></span>
                                </span>
                                <em class="hidden-xs">{% trans "available" %}</em>
                            {% else %}
                                <span class="visible-xs-inline-block glyphicon glyphicon-stack" title="{% trans "unavailable" %}">
                                    <span class="place-marker glyphicon-home glyphicon-stack-2x"></span>
                                    <span class="place-availability glyphicon-remove glyphicon-stack-1x"></span>
                                </span>
                                <em class="hidden-xs">{% trans "unavailable" %}</em>
                            {% endif %}
                        </p>
                        {% if user.is_authenticated %}
                            <p class="col-xs-9 address">
                                {% if user in place.authorized_users.all %}
                                    {{ place.address }}
                                    <br />
                                {% endif %}

                                {{ place.postcode }}

                                {% if place.closest_city %}
                                    {% blocktrans with city=place.city closest_city=place.closest_city trimmed %}
                                        {{ city }}, near {{ closest_city }}
                                    {% endblocktrans %}
                                {% else %}
                                    {{ place.city }}
                                {% endif %}

                                <br />

                                {{ place.get_country_display }}
                            </p>
                        {% endif %}

                        {% if user in place.authorized_users.all %}
                            {% for phone in place.owner.phones.all %}
                                <p class="col-xs-12">
                                    {{ phone.icon }}
                                    {% if phone.country %}
                                        <span title="{{ phone.get_country_display }}">({{ phone.country }})</span>
                                    {% endif %}
                                    <span style="white-space: nowrap">{{ phone.number.as_international }}</span>&nbsp;
                                    <br class="visible-xxs-inline" />
                                    <em><small>{{ phone.comments }}</small></em>
                                </p>
                            {% endfor %}
                        {% endif %}
                    </div>

                </div>
            </div>

            <div class="row">
            {% if user.is_authenticated %}
                <div class="col-md-12 hidden-xs hidden-sm">
                    {% if place.any_accommodation_details %}
                        <h3>{% trans "Description" %}</h3>
                        {% include 'hosting/snippets/place_description.html' with description=place.description contact_before=place.contact_before max_host=place.max_guest max_night=place.max_night %}
                    {% endif %}
                    {% if place.conditions.all %}
                        {% include 'hosting/snippets/place_conditions.html' with conditions=place.conditions.all %}
                    {% endif %}

                    {% if place.family_members.all and user in place.authorized_users.all %}
                        <h3>{% trans "Family members" %}</h3>
                        <ul>
                            {% for member in place.family_members.all %}
                                <li>
                                    {{ member.full_name }}
                                    {% if member.age %}
                                        ({{ member.age }})
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% else %}
                {% include 'hosting/snippets/registration.html' %}
            {% endif %}
            </div>
        </div>

        <div class="map col-xs-12 col-md-6">
                <iframe width="100%"
                    frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                    src="http://www.openstreetmap.org/export/embed.html?bbox={{ place.bbox }}{% if user.is_authenticated %}&amp;marker={{ place.latitude|stringformat:'f' }},{{ place.longitude|stringformat:'f' }}{% endif %}">
                </iframe>
        </div>

        {% if user.is_authenticated %}
            <div class="col-xs-12 hidden-md hidden-lg description-small">
                {% include 'hosting/snippets/place_description.html' with description=place.description contact_before=place.contact_before max_host=place.max_guest max_night=place.max_night %}
                {% if place.conditions.all %}
                    {% include 'hosting/snippets/place_conditions.html' with conditions=place.conditions.all %}
                {% endif %}
            </div>

            {% if user.profile == place.owner %}
                <p class="col-xs-12 btn-group">
                    <a href="{% url 'place_update' place.pk %}" class="btn btn-success" title="{% trans "Update" %}">
                        <span class="glyphicon glyphicon-pencil"></span> {% trans "Update" %}
                    </a>
                    <a href="{% url 'authorize_user' place.pk %}?next={{ request.get_full_path|urlencode }}" 
                       class="btn btn-warning"
                       title="{% trans "Authorizations" %}">
                        <span class="glyphicon glyphicon-eye-open"></span>
                        <span class="hidden-xs">{% trans "Authorizations" %}</span>
                    </a>
                </p>
            {% else %}
                <p class="col-xs-12">
                    <a href="{% url 'postman_write' place.owner.user.username %}" class="btn btn-primary">
                        <span class="glyphicon glyphicon-send"></span>&nbsp; {% trans "Write message" %}
                    </a>
                </p>
            {% endif %}
        {% endif %}

        {% if user.is_authenticated %}
        {% if user.profile in place.family_members.all or user.profile == place.owner %}
            <div class="col-xs-12">
                <p>
                    {% trans "Short description" %}:&nbsp; {{ place.short_description|default:"&ndash;" }}
                </p>
                <p>
                    {% trans "Available" %}:&nbsp; 
                    <span class="glyphicon glyphicon-{{ place.available|yesno:'ok,remove' }}"></span> 
                    {{ place.available|yesno }}
                </p>
                <p>
                    {% trans "Print in book" %}:&nbsp; 
                    <span class="glyphicon glyphicon-{{ place.in_book|yesno:'ok,remove' }}"></span> 
                    {{ place.in_book|yesno }}
                </p>
            </div>
        {% endif %}
        {% endif %}
    </div>
{% endblock page %}
