/* InstantClick master@a603458 | (C) 2014-2016 Alexandre Dieulot | http://instantclick.io/license */
var instantClick,InstantClick=instantClick=function(a,b,c){function A(a){var b=a.indexOf("#");return b==-1?a:a.substr(0,b)}function B(a){for(;a&&"A"!=a.nodeName;)a=a.parentNode;return a}function C(a){do{if(!a.hasAttribute)break;if(a.hasAttribute("data-instant"))return!1;if(a.hasAttribute("data-no-instant"))return!0}while(a=a.parentNode);return!1}function D(a){var c=b.protocol+"//"+b.host;return!(a.target||a.hasAttribute("download")||0!=a.href.indexOf(c+"/")||a.href.indexOf("#")>-1&&A(a.href)==d||C(a))}function E(a){for(var b=Array.prototype.slice.call(arguments,1),c=!1,d=0;d<w[a].length;d++)if("receive"==a){var e=w[a][d].apply(window,b);e&&("body"in e&&(b[1]=e.body),"title"in e&&(b[2]=e.title),c=e)}else w[a][d].apply(window,b);return c}function F(e,f,g,h){if(I(),a.documentElement.replaceChild(f,a.body),a.title=e,g){K("remove"),g!=b.href&&(history.pushState(null,null,g),c.indexOf(" CriOS/")>-1&&(a.title==e?a.title=e+String.fromCharCode(160):a.title=e));var i=g.indexOf("#"),j=i>-1&&a.getElementById(g.substr(i+1)),l=0;if(j)for(;j.offsetParent;)l+=j.offsetTop,j=j.offsetParent;"requestAnimationFrame"in window?requestAnimationFrame(function(){scrollTo(0,l)}):scrollTo(0,l),d=A(g),z[d]=[],U(!1),E("change",!1)}else scrollTo(0,h),k.abort(),G(),E("restore")}function G(){r=!1,s=!1}function H(a){return a.replace(/<noscript[\s\S]+?<\/noscript>/gi,"")}function I(){for(var a=0;a<x.length;a++)clearTimeout(x[a]);x=[];for(var a=0;a<y.length;a++)"object"==typeof y[a]&&"abort"in y[a]&&(y[a].instantKilled=!0,y[a].abort());y=[]}function J(){k.abort(),G()}function K(a){if(d in z)for(var b=0;b<z[d].length;b++)window[a+"EventListener"].apply(window,z[d][b])}function L(a){var b=B(a.target);b&&D(b)&&V(b.href)}function M(a){if(!(g>+new Date-500||+new Date-q<100)){var b=B(a.target);b&&b!=B(a.relatedTarget)&&D(b)&&(b.addEventListener("mouseout",Q),s||(e=b.href,f=ca(V,v)))}}function N(a){g=+new Date;var b=B(a.target);b&&D(b)&&(b.addEventListener("touchend",R),b.addEventListener("touchcancel",R),V(b.href))}function O(){a.body.addEventListener("click",P)}function P(b){if(a.body.removeEventListener("click",P),i&&(clearTimeout(i),i=!1),!b.defaultPrevented){var c=B(b.target);c&&D(c)&&(b.which>1||b.metaKey||b.ctrlKey||(b.preventDefault(),W(c.href)))}}function Q(a){if(B(a.target)!=B(a.relatedTarget))return f?(clearTimeout(f),void(f=!1)):void(r&&!s&&(k.abort(),G()))}function R(a){r&&!s&&(i=ca(J,500))}function S(){if(2==k.readyState){var c=k.getResponseHeader("Content-Type");c&&/^text\/html/i.test(c)||(n=!0)}if(!(k.readyState<4)){if(0==k.status)return $gotANetworkError=!0,void(s&&(E("exit",l,"network error"),b.href=l));if(n)return void(s&&(E("exit",l,"non-html content-type"),b.href=l));var d=a.implementation.createHTMLDocument("");d.documentElement.innerHTML=H(k.responseText),m=d.title,p=d.body;var e=E("receive",l,p,m);e&&("body"in e&&(p=e.body),"title"in e&&(m=e.title));var f=A(l);j[f]={body:p,title:m,scrollPosition:f in j?j[f].scrollPosition:0};for(var i,q,g=d.head.children,h=0,r=0;r<g.length;r++)if(i=g[r],i.hasAttribute("data-instant-track")){q=i.getAttribute("href")||i.getAttribute("src")||i.textContent;for(var u=0;u<t.length;u++)t[u]==q&&h++}h!=t.length&&(o=!0),s&&(s=!1,W(l))}}function T(){var a=A(b.href);if(a!=d){if(s&&(G(),k.abort()),!(a in j))return E("exit",b.href,"not in history"),void(a==b.href?b.href=b.href:b.reload());j[d].scrollPosition=pageYOffset,K("remove"),d=a,F(j[a].title,j[a].body,!1,j[a].scrollPosition),K("add")}}function U(b){if(a.body.addEventListener("touchstart",N,!0),u?a.body.addEventListener("mousedown",L,!0):a.body.addEventListener("mouseover",M,!0),a.body.addEventListener("click",O,!0),!b){var e,f,g,h,i,c=a.body.getElementsByTagName("script"),d=[];for(i=0;i<c.length;i++)d.push(c[i]);for(i=0;i<d.length;i++)if(e=d[i],e&&!e.hasAttribute("data-no-instant")){f=a.createElement("script");for(var j=0;j<e.attributes.length;j++)f.setAttribute(e.attributes[j].name,e.attributes[j].value);f.textContent=e.textContent,g=e.parentNode,h=e.nextSibling,g.removeChild(e),g.insertBefore(f,h)}}}function V(a){f&&(clearTimeout(f),f=!1),a||(a=e),r&&(a==l||s)||(r=!0,s=!1,l=a,p=!1,n=!1,$gotANetworkError=!1,o=!1,E("preload"),k.open("GET",a),k.timeout=9e4,k.send())}function W(a){return q=+new Date,f||!r?f&&l&&l!=a?(E("exit",a,"click occured while preloading planned"),void(b.href=a)):(V(a),E("wait"),void(s=!0)):s?(E("exit",a,"clicked on a link while waiting for another page to display"),void(b.href=a)):n?(E("exit",l,"non-html content-type"),void(b.href=l)):$gotANetworkError?(E("exit",l,"network error"),void(b.href=l)):o?(E("exit",l,"different assets"),void(b.href=l)):p?(j[d].scrollPosition=pageYOffset,G(),void F(m,p,l)):(E("wait"),void(s=!0))}function aa(c){if(!X)return void E("change",!0);if(!h){h=!0,"mousedown"==c?u=!0:"number"==typeof c&&(v=c),d=A(b.href),j[d]={body:a.body,title:a.title,scrollPosition:pageYOffset};for(var f,g,e=a.head.children,i=0;i<e.length;i++)f=e[i],f.hasAttribute("data-instant-track")&&(g=f.getAttribute("href")||f.getAttribute("src")||f.textContent,t.push(g));k=new XMLHttpRequest,k.addEventListener("readystatechange",S),U(!0),addEventListener("popstate",T)}}function ba(a,b){w[a].push(b),"change"==a&&b(!q)}function ca(){var a=window.setTimeout.apply(window,arguments);return x.push(a),a}function da(){var a=window.setInterval.apply(window,arguments);return x.push(a),a}function ea(a){return a||(a=new XMLHttpRequest),y.push(a),a}function fa(){d in z||(z[d]=[]),z[d].push(arguments),addEventListener.apply(window,arguments)}var d,e,f,g,h,i,k,n,o,u,j={},l=!1,m=!1,p=!1,q=0,r=!1,s=!1,t=[],v=65,w={preload:[],receive:[],wait:[],change:[],restore:[],exit:[]},x=[],y=[],z={},X=!1;if("pushState"in history&&"file:"!=b.protocol){X=!0;var Y=c.indexOf("Android ");if(Y>-1){var Z=parseFloat(c.substr(Y+"Android ".length));if(Z<4.4&&(X=!1,Z>=4))for(var $=[/ Chrome\//,/ UCBrowser\//,/ Firefox\//,/ Windows Phone /],_=0;_<$.length;_++)if($[_].test(c)){X=!0;break}}}return{supported:X,init:aa,on:ba,setTimeout:ca,setInterval:da,xhr:ea,addEventListener:fa}}(document,location,navigator.userAgent);